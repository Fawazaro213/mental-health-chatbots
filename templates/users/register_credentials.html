{% extends 'base.html' %}
{% load widget_tweaks %}
{% block title %}Complete Registration | MindCare{% endblock %}

{% block content %}
<div class="registration-container py-5" style="background-color: var(--gray-light); min-height: 80vh;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <!-- Registration Card -->
                <div class="registration-card shadow-lg rounded-lg overflow-hidden">
                    <!-- Card Header -->
                    <div class="registration-card-header text-center py-4" style="background-color: var(--teal-tranquil);">
                        <h3 class="mb-0 text-white">
                            <i class="fas fa-user-graduate me-2"></i>Welcome, {{ student_data.first_name }}!
                        </h3>
                    </div>
                    
                    <!-- Card Body -->
                    <div class="registration-card-body p-4 p-md-5">
                        <!-- Student Info Alert -->
                        <div class="registration-alert mb-4">
                            <h5 class="registration-alert-heading">
                                <i class="fas fa-check-circle me-2"></i>Verified Student Information
                            </h5>
                            <div class="registration-alert-content">
                                <p class="mb-2"><strong><i class="fas fa-id-card me-2"></i>Matric Number:</strong> {{ student_data.matric_number }}</p>
                                <p class="mb-2"><strong><i class="fas fa-user me-2"></i>Name:</strong> {{ student_data.first_name }} {{ student_data.last_name }}</p>
                                <p class="mb-2"><strong><i class="fas fa-university me-2"></i>Faculty/Department:</strong> {{ student_data.faculty }} / {{ student_data.department }}</p>
                                <p class="mb-0"><strong><i class="fas fa-envelope me-2"></i>Email:</strong> {{ student_data.email }}</p>
                            </div>
                        </div>
                        
<!-- Registration Form -->
<h5 class="registration-form-title mb-4">
    <i class="fas fa-key me-2"></i>Create Your Account Credentials
</h5>

<form method="post" class="needs-validation" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}
    
<!-- Password Field -->
<div class="registration-input-group mb-4">
    <label for="{{ form.password1.id_for_label }}" class="registration-form-label mb-1">
        <i class="fas fa-lock me-2"></i>Password
    </label>
    <div class="position-relative">
        {{ form.password1|add_class:"form-control shadow-sm border rounded pe-5" }}
        <span class="position-absolute top-50 end-0 translate-middle-y me-3 toggle-password text-muted"
              style="cursor: pointer; z-index: 5;" data-target="id_password1">
            <i class="fas fa-eye"></i>
        </span>
    </div>

    <div class="password-requirements mt-3">
        <small class="registration-requirement" id="pw-length"><i class="fas fa-circle me-1"></i>At least 8 characters</small>
        <small class="registration-requirement" id="pw-uppercase"><i class="fas fa-circle me-1"></i>At least one uppercase letter</small>
        <small class="registration-requirement" id="pw-lowercase"><i class="fas fa-circle me-1"></i>At least one lowercase letter</small>
        <small class="registration-requirement" id="pw-number"><i class="fas fa-circle me-1"></i>At least one number</small>
        <small class="registration-requirement" id="pw-symbol"><i class="fas fa-circle me-1"></i>At least one special character</small>
    </div>
    {% if form.password1.errors %}
        <div class="registration-error text-danger small mt-2">
            {{ form.password1.errors }}
        </div>
    {% endif %}
</div>

<!-- Confirm Password Field -->
<div class="registration-input-group mb-4">
    <label for="{{ form.password2.id_for_label }}" class="registration-form-label mb-1">
        <i class="fas fa-lock me-2"></i>Confirm Password
    </label>
    <div class="position-relative">
        {{ form.password2|add_class:"form-control shadow-sm border rounded pe-5" }}
        <span class="position-absolute top-50 end-0 translate-middle-y me-3 toggle-password text-muted"
              style="cursor: pointer; z-index: 5;" data-target="id_password2">
            <i class="fas fa-eye"></i>
        </span>
    </div>

    {% if form.password2.errors %}
        <div class="registration-error text-danger small mt-2">
            {{ form.password2.errors }}
        </div>
    {% endif %}
    {% if form.password2.help_text %}
        <small class="registration-help-text form-text text-muted mt-2">
            {{ form.password2.help_text }}
        </small>
    {% endif %}
</div>

<!-- Terms and Conditions -->
<div class="form-check mb-4">
    <input type="checkbox" class="form-check-input" id="termsCheckbox" required>
    <label class="form-check-label" for="termsCheckbox">
        I agree to the <a href="{% url 'terms' %}" target="_blank">Terms and Conditions</a> and 
        <a href="{% url 'privacy' %}" target="_blank">Privacy Policy</a>.
        <span class="text-danger">*</span>
    </label>
    <div class="invalid-feedback">
        You must agree to the terms and conditions to proceed.
    </div>
</div>

<!-- Submit Button (Initially Disabled) -->
<button type="submit" id="registerSubmitBtn" class="registration-btn w-100 py-2" disabled>
    <i class="fas fa-user-check me-2"></i>Complete Registration
</button>

</form>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Password Validation Scripts -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Toggle password visibility
    document.querySelectorAll(".toggle-password").forEach(toggle => {
        toggle.addEventListener("click", function () {
            const targetId = this.getAttribute('data-target');
            const input = document.getElementById(targetId);
            const icon = this.querySelector('i');

            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace("fa-eye", "fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.replace("fa-eye-slash", "fa-eye");
            }
        });
    });

    // Password strength logic
    const passwordInput = document.getElementById("id_password1");
    const requirements = {
        length: document.getElementById("pw-length"),
        uppercase: document.getElementById("pw-uppercase"),
        lowercase: document.getElementById("pw-lowercase"),
        number: document.getElementById("pw-number"),
        symbol: document.getElementById("pw-symbol"),
    };

    if (passwordInput) {
        passwordInput.addEventListener("input", function () {
            const val = passwordInput.value;
            requirements.length.className = val.length >= 8 ? "requirement-valid" : "requirement-invalid";
            requirements.uppercase.className = /[A-Z]/.test(val) ? "requirement-valid" : "requirement-invalid";
            requirements.lowercase.className = /[a-z]/.test(val) ? "requirement-valid" : "requirement-invalid";
            requirements.number.className = /\d/.test(val) ? "requirement-valid" : "requirement-invalid";
            requirements.symbol.className = /[\W_]/.test(val) ? "requirement-valid" : "requirement-invalid";
        });
    }

    // Confirm password match
    const confirmInput = document.getElementById("id_password2");
    function validateMatch() {
        if (!confirmInput.value) {
            confirmInput.classList.remove("password-match", "password-mismatch");
        } else if (passwordInput.value === confirmInput.value) {
            confirmInput.classList.remove("password-mismatch");
            confirmInput.classList.add("password-match");
        } else {
            confirmInput.classList.remove("password-match");
            confirmInput.classList.add("password-mismatch");
        }
    }

    if (passwordInput && confirmInput) {
        passwordInput.addEventListener("input", validateMatch);
        confirmInput.addEventListener("input", validateMatch);
    }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const checkbox = document.getElementById("termsCheckbox");
    const submitBtn = document.getElementById("registerSubmitBtn");

    checkbox.addEventListener("change", function () {
        submitBtn.disabled = !this.checked;
    });
});
</script>
<style>
    .toggle-password {
    pointer-events: auto;
}
button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

</style>
{% endblock %}

{% block footer %}
{% endblock %}