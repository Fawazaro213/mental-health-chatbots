{% extends 'base.html' %}

{% block title %}Complete Your Registration{% endblock %}


{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">Welcome, {{ student_data.first_name }}!</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-4">
                        <h5 class="alert-heading">Verified Student Information</h5>
                        <hr>
                        <p class="mb-1"><strong>Matric Number:</strong> {{ student_data.matric_number }}</p>
                        <p class="mb-1"><strong>Name:</strong> {{ student_data.first_name }} {{ student_data.last_name }}</p>
                        <p class="mb-1"><strong>Faculty/Department:</strong> {{ student_data.faculty }} / {{ student_data.department }}</p>
                        <p class="mb-0"><strong>Email:</strong> {{ student_data.email }}</p>
                    </div>
                    
                    <h5 class="mb-3">Create Your Account Credentials</h5>
                    <form method="post">
                        {% csrf_token %}
                        {{ form.non_field_errors }}
                        
                        <div class="mb-3">
                            {{ form.username.label_tag }}
                            {{ form.username }}
                            {{ form.username.errors }}
                            <small class="form-text text-muted">{{ form.username.help_text }}</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                {{ form.password1.label_tag }}
                                <button type="button" class="btn btn-sm btn-link toggle-password" data-target="id_password1">
                                    üëÅÔ∏è Show
                                </button>
                            </div>
                            {{ form.password1 }}
                            {{ form.password1.errors }}
                            <div class="password-requirements mt-2">
                                <small class="form-text text-danger" id="pw-length">‚ùå At least 8 characters</small>
                                <small class="form-text text-danger" id="pw-uppercase">‚ùå At least one uppercase letter</small>
                                <small class="form-text text-danger" id="pw-lowercase">‚ùå At least one lowercase letter</small>
                                <small class="form-text text-danger" id="pw-number">‚ùå At least one number</small>
                                <small class="form-text text-danger" id="pw-symbol">‚ùå At least one special character</small>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="d-flex justify-content-between">
                                {{ form.password2.label_tag }}
                                <button type="button" class="btn btn-sm btn-link toggle-password" data-target="id_password2">
                                    üëÅÔ∏è Show
                                </button>
                            </div>
                            {{ form.password2 }}
                            {{ form.password2.errors }}
                            <small class="form-text text-muted">{{ form.password2.help_text }}</small>
                        </div>
                        
                        <button type="submit" class="btn btn-success w-100">Complete Registration</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Password Validation Scripts -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Toggle password visibility
    document.querySelectorAll(".toggle-password").forEach(toggle => {
        toggle.addEventListener("click", function () {
            const input = document.getElementById(this.getAttribute('data-target'));
            if (input.type === "password") {
                input.type = "text";
                this.innerHTML = "üôà Hide";
            } else {
                input.type = "password";
                this.innerHTML = "üëÅÔ∏è Show";
            }
        });
    });

    // Password strength validation
    const passwordInput = document.getElementById("id_password1");
    const requirements = {
        length: document.getElementById("pw-length"),
        uppercase: document.getElementById("pw-uppercase"),
        lowercase: document.getElementById("pw-lowercase"),
        number: document.getElementById("pw-number"),
        symbol: document.getElementById("pw-symbol"),
    };

    passwordInput.addEventListener("input", function () {
        const val = passwordInput.value;

        requirements.length.className = val.length >= 8 ? "text-success" : "text-danger";
        requirements.length.textContent = (val.length >= 8 ? "‚úÖ" : "‚ùå") + " At least 8 characters";

        requirements.uppercase.className = /[A-Z]/.test(val) ? "text-success" : "text-danger";
        requirements.uppercase.textContent = (/[A-Z]/.test(val) ? "‚úÖ" : "‚ùå") + " At least one uppercase letter";

        requirements.lowercase.className = /[a-z]/.test(val) ? "text-success" : "text-danger";
        requirements.lowercase.textContent = (/[a-z]/.test(val) ? "‚úÖ" : "‚ùå") + " At least one lowercase letter";

        requirements.number.className = /\d/.test(val) ? "text-success" : "text-danger";
        requirements.number.textContent = (/\d/.test(val) ? "‚úÖ" : "‚ùå") + " At least one number";

        requirements.symbol.className = /[\W_]/.test(val) ? "text-success" : "text-danger";
        requirements.symbol.textContent = (/[\W_]/.test(val) ? "‚úÖ" : "‚ùå") + " At least one special character";
    });

    // Password confirmation validation
    const pw1 = document.getElementById("id_password1");
    const pw2 = document.getElementById("id_password2");

    function validateConfirmPassword() {
        if (!pw2.value) {
            pw2.style.borderColor = "";
        } else if (pw1.value === pw2.value) {
            pw2.style.borderColor = "green";
        } else {
            pw2.style.borderColor = "red";
        }
    }

    pw1.addEventListener("input", validateConfirmPassword);
    pw2.addEventListener("input", validateConfirmPassword);
});
</script>

<style>
    /* Add some visual feedback for password fields */
    #id_password1, #id_password2 {
        transition: border-color 0.3s ease;
    }
    
    .password-requirements small {
        display: block;
        margin-bottom: 2px;
    }
    
    .text-success {
        color: #28a745 !important;
    }
    
    .text-danger {
        color: #dc3545 !important;
    }
</style>
{% endblock %}